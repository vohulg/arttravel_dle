// JavaScript Document
// TWS Gallery - by Al-x
// Version TWS Gallery 5.2
// Powered by http://wonderfullife.ru/
// Support by http://wonderfullife.ru/, http://inker.wonderfullife.ru/
//-----------------------------------------------------
// Copyright (c) 2007,2012 TWS
var StopUpload=0;var numUploaded=0;var twsg_opened_rows=2;function uploadFlashReady(){var a=document.getElementById("entryform");if(!a||!a.cat||!a.cat.value||a.cat.value=="0"||a.cat.value==""){a.btnBrowse.value=gallery_lang_upload.js16}else{a.btnBrowse.disabled=false;a.btnBrowse.value=gallery_lang_upload.js18}}function fileQueued(b){StopUpload=0;var k=new FileProgress(b,this.customSettings.progressTarget),j="",g=b.type.replace(".",""),f,d,h=false;var f=0;while(d=this.getFile(f)){f++;if(d&&d.filestatus===SWFUpload.FILE_STATUS.QUEUED&&d.name==b.name){if(h){j=gallery_lang_upload.js15;break}h=true}}g=g.toLowerCase();if(j==""&&limitsizetable&&limitsizetable[g]&&limitsizetable[g]<Math.ceil(b.size/1024)){j=gallery_lang_upload["5"]}if(j!=""){k.setError();k.toggleCancel(false);k.setStatus(j);StopUpload=1;this.cancelUpload(b.id)}else{k.setStatus(gallery_lang_upload.js1);k.toggleCancel(true,this)}}function fileDialogComplete(d,c){if(d>0){setUploadButton(false,true)}}function fileQueueError(f,g,e){if(g===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){DLEalert(gallery_lang_upload.js2+(e===0?gallery_lang_upload.js3:gallery_lang_upload.js4.replace("{num}",e)),dle_info);return}var h=new FileProgress(f,this.customSettings.progressTarget);h.setError();h.toggleCancel(false);switch(g){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:h.setStatus(gallery_lang_upload["5"]);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:h.setStatus(gallery_lang_upload["24"]);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:h.setStatus(gallery_lang_upload["3"]);break;default:f!==null&&h.setStatus(gallery_lang_upload.js5)}}function uploadError(g,j,f){if(StopUpload){StopUpload=0;return}var k=new FileProgress(g,this.customSettings.progressTarget),h;k.setError();k.toggleCancel(false);switch(j){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:h=gallery_lang_upload.js8+f;break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:h=gallery_lang_upload.js9;break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:h=gallery_lang_upload.js10;break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:h=gallery_lang_upload.js11;break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:h=gallery_lang_upload.js3;break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:h=gallery_lang_upload.js12;break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:h=gallery_lang_upload.js13;k.setCancelled();if(this.getStats().files_queued===0){setUploadButton(true,true)}break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:k.setStatus(gallery_lang_upload.js1);k.toggleCancel(true,this);return;default:h=gallery_lang_upload.js5+j;break}k.setStatus(h)}function uploadStart(b){var d=new FileProgress(b,this.customSettings.progressTarget);d.setStatus(gallery_lang_upload.js6);d.toggleCancel(true,this);return true}function uploadProgress(f,e,h){var g=Math.ceil((e/h)*100),j=new FileProgress(f,this.customSettings.progressTarget);j.setProgress(g);if(g==100){j.setStatus(gallery_lang_upload.js14);j.toggleCancel(false,this)}else{j.setStatus(gallery_lang_upload.js6+" "+g+"%");j.toggleCancel(true,this)}}function uploadSuccess(e,g){var c=new FileProgress(e,this.customSettings.progressTarget);if(!cattitle){cattitle={id:0,a:"",t:""}}var f=g.match(/\[HTML:Errors\](.*?)\[END:HTML:Errors\]/g);if(f){this.cancelQueue();c.setCancelled();f=g.replace(/\[HTML:Errors\](.*?)\[END:HTML:Errors\]/g,"$1");DLEalert(gallery_lang_upload[f].replace("{cattitle}",cattitle.t),dle_info)}else{g=parseInt(g);if(isNaN(g)||!isFinite(g)||g<1){c.setStatus(gallery_lang_upload.js7);c.setComplete();c.toggleCancel(false);numUploaded++}else{if(gallery_lang_upload[g]){c.setStatus(gallery_lang_upload[g])}else{c.setStatus("Unknown Error: "+g+" Please, report site administrator!")}c.setError();c.toggleCancel(false)}}}function uploadComplete(b){}function queueComplete(b){setUploadButton((this.getStats().files_queued===0?true:false),true);var d=document.getElementById("entryform");var e=(gallery_advance_default!="2"&&d.upload_mode)?d.upload_mode.value:gallery_advance_default;if(numUploaded){if(e==0){setTimeout(function(){ShowLoading("");$.get(dle_root+"engine/gallery/ajax/upload.php",{skin:dle_skin,action:"complete"},function(a){HideLoading("");a=cas(a,0,0);if(a){$("#dle-content").html(a);setTimeout(function(){$("html:not(:animated)"+(!$.browser.opera?",body:not(:animated)":"")).animate({scrollTop:$("#dle-content").position().top-70},700)},100)}})},2500)}else{if(e==2){setTimeout(function(){location.replace(dle_root+dle_admin+"?mod=twsgallery&act=12&ap=1&cat="+d.cat.value+"&rndval="+new Date().getTime())},1500)}else{if(!cattitle){cattitle={m:0,id:0,a:"",t:""}}$("#dlegallerypopup").remove();title_on_moderation=cattitle.m?"<br /><br />"+gallery_lang_upload.js20:"";$("body").append("<div id='dlegallerypopup' title='"+dle_info+"' style='display:none'><br />"+gallery_lang_upload.js19.replace("{num}",numUploaded)+title_on_moderation+"</div>");var c={};c.Ok=function(){$(this).dialog("close");$("#dlegallerypopup").remove()};c[gallery_lang_upload.js21]=function(){$(this).dialog("close");$("#dlegallerypopup").remove();location.replace(dle_root+(gallery_alt_url=="yes"?gallery_web_root+cattitle.a+"/":"index.php?do=gallery&act=1&cid="+cattitle.id))};$("#dlegallerypopup").dialog({autoOpen:true,width:470,dialogClass:"modalfixed",buttons:c});$(".modalfixed.ui-dialog").css({position:"fixed"});$("#dlegallerypopup").dialog("option","position",["0","0"])}}numUploaded=0}}function setUploadButton(b,a){if(b!="null"){ob=document.getElementById(swfu.customSettings._StartButtonId);if(ob){ob.disabled=b}}if(a!="null"){ob=document.getElementById(swfu.customSettings.cancelButtonId);if(ob){ob.disabled=a}}}function upload_check(d){var c=[],b=document.getElementById("entryform"),a;if(!b||!b.cat||!b.cat.value||b.cat.value=="0"||b.cat.value==""){c[0]=gallery_lang_upload.js17}if(gallery_file_title_control!="0"&&b.foto_title.value==""){c[c.length]=gallery_lang_upload["21"]}if(c.length<1){if(d==1||swfu.getStats().files_queued>0){setUploadButton(true,false);c=b.elements;for(i=0;i<c.length;i++){if(n=c[i].name){a="";switch(c[i].type){case"select":a=c[i].options[c[i].selectedIndex].value;break;case"radio":case"checkbox":a=c[i].checked?1:0;break;default:a=c[i].value;break}swfu.addPostParam(n,a)}}swfu.startUpload();return false}return true}DLEalert(c.join("<br />"),dle_info);return false}function show_rules(a){ShowLoading("");$.get(dle_root+"engine/gallery/ajax/upload.php",{id:a,skin:dle_skin,action:"rules"},function(b){HideLoading("");RunAjaxJS("rules-layer",b);document.getElementById("btnBrowse").disabled=false;document.getElementById("btnBrowse").value=gallery_lang_upload.js18;el=document.getElementById("foto_title");if(!cattitle){cattitle={id:0,a:"",t:""}}if(el){el.value=cattitle.t}})}function AddImages(h,a,c,b){var f=document.getElementById(h);if(!gallery_max_once_upload){gallery_max_once_upload=50}if(twsg_opened_rows<gallery_max_once_upload){twsg_opened_rows++;var g=f.insertRow(f.rows.length);var d=g.insertCell(0);var e=document.createElement("input");e.setAttribute("type",c);e.setAttribute("name",a);e.setAttribute("size",b);d.appendChild(e)}}function RemoveImages(b){var a=document.getElementById(b);if(a.rows.length>1){a.deleteRow(a.rows.length-1);twsg_opened_rows--}};