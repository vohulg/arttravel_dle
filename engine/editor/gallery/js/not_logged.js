// JavaScript Document
// TWS Gallery - by Al-x
// Version TWS Gallery 5.2
// Powered by http://wonderfullife.ru/
// Support by http://wonderfullife.ru/, http://inker.wonderfullife.ru/
//-----------------------------------------------------
// Copyright (c) 2007,2012 TWS
function cas(d,a,b){twsg_status={e:0,k:0};var c="";if(d.match(/\[HTML:Errors\](.*?)\[END:HTML:Errors\]/g)){twsg_status.e++;c+=d.replace(/\[HTML:Errors\](.*?)\[END:HTML:Errors\]/g,"$1");d=d.replace(/\[HTML:Errors\](.*?)\[END:HTML:Errors\]/g,"")}else{if(d.match(/\[HTML:Ok\](.*?)\[END:HTML:Ok\]/g)){twsg_status.k++;c+=d.replace(/\[HTML:Ok\](.*?)\[END:HTML:Ok\]/g,"$1");d=d.replace(/\[HTML:Ok\](.*?)\[END:HTML:Ok\]/g,"")}}if(c!=""&&a){DLEalert(c,dle_info)}if(b){setTimeout(function(){$("#dlepopup").dialog("close")},(b*1000))}return d}function GalUserMenu(b,a){var c=new Array();c[0]="<a onclick=\"ShowProfile('"+a+"', '"+b+"', "+gallery_admin_editusers+'); return false;" href="'+b+'">'+menu_profile+"</a>";c[1]='<a href="'+dle_root+"index.php?do=gallery&act=4&gal_user="+a+'">'+gallery_lang_web[0]+"</a>";c[2]='<a href="'+dle_root+(gallery_alt_url=="yes"?(gallery_web_root+"all/user-"+a+"/"):("index.php?do=gallery&act=15&p=user-"+a))+'">'+gallery_lang_web[1]+"</a>";c[3]='<a href="'+dle_root+(gallery_alt_url=="yes"?(gallery_web_root+"users/"+a+"/"):("index.php?do=gallery&act=28&gal_user="+a))+'">'+gallery_lang_web[2]+"</a>";return c}function MenuGalComment(a){var b=new Array();b[0]="<a onclick=\"twsg_ajax_comm_edit('"+a+'\'); return false;" href="#">'+menu_short+"</a>";b[1]='<a href="'+dle_root+"index.php?do=gallery&act=3&dle_allow_hash="+dle_login_hash+"&subaction=comm_edit&com_id="+a+'">'+menu_full+"</a>";return b}function doAddTWSGComments(){var g=document.getElementById("dle-comments-form");if(dle_wysiwyg=="yes"||dle_wysiwyg=="1"||dle_wysiwyg=="2"){if(gallery_dle_id>95&&dle_wysiwyg!="2"){submit_all_data()}else{document.getElementById("comments").value=$("#comments").html()}var e="wysiwyg"}else{var e=""}if(g.comments.value==""||g.name.value==""){DLEalert(dle_req_field,dle_info);return false}var d=g.allow_subscribe?g.allow_subscribe.value:"";var c=g.question_answer?g.question_answer.value:"";var f=g.sec_code?g.sec_code.value:"";var a=g.recaptcha_response_field?Recaptcha.get_response():"";var b=g.recaptcha_response_field?Recaptcha.get_challenge():"";ShowLoading("");$.post(dle_root+"engine/gallery/ajax/comments.php",{id:g.id.value,allow_subscribe:d,comments:g.comments.value,name:g.name.value,mail:g.mail.value,editor_mode:e,skin:dle_skin,sec_code:f,question_answer:c,recaptcha_response_field:a,recaptcha_challenge_field:b,action:"add"},function(h){if(g.sec_code){g.sec_code.value="";reload()}HideLoading("");RunAjaxJS("dle-ajax-comments",h);if(h!="error"&&document.getElementById("blind-animation")){$("html"+(!$.browser.opera?",body":"")).animate({scrollTop:$("#dle-ajax-comments").position().top-70},1100);setTimeout(function(){$("#blind-animation").show("blind",{},1500)},1100)}})}function GalRate(a,b){ShowLoading("");$.get(dle_root+"engine/gallery/ajax/file.php",{go_rate:a,id:b,skin:dle_skin,act:2},function(c){HideLoading("");$("#ratig-layer-"+b).html(c)})}function subscribe_comments(f,a){var c="",d="";var e=function(g){if(!a&&$("#dle-promt-text").val().length<5){$("#dle-promt-text").addClass("ui-state-error");return false}else{if(!a){c=$("#dle-promt-text").val()}}$(this).dialog("close");$("#dlepopup").remove();ShowLoading("");$.post(dle_root+"engine/gallery/ajax/comments.php",{email:c,user_id:a,hash:d,action:g,skin:dle_skin,fid:f},function(h){HideLoading("");if(h.status!="found"){DLEalert(h.txt1,dle_info)}else{d=h.hash;b(h)}},"json")};var b=function(i){var h={},g=gallery_lang_web[4];h[dle_act_lang[3]]=function(){$(this).dialog("close")};if(i&&i.txt3){g=i.txt1;h[i.txt2]=function(){e("unsubscribe")};h[i.txt3]=function(){f=0;e("unsubscribe")}}else{h.OK=function(){e("subscribe")}}$("#dlepopup").remove();if(!a){g+="<br /><br /><input type='text' name='dle-promt-text' id='dle-promt-text' class='ui-widget-content ui-corner-all' style='width:80%; padding: .4em;' value='"+c+"'/>"}$("body").append("<div id='dlepopup' title='"+gallery_lang_web[3]+"' style='display:none'><br />"+g+"</div>");$("#dlepopup").dialog({autoOpen:true,width:500,dialogClass:"modalfixed",buttons:h});$(".modalfixed.ui-dialog").css({position:"fixed"});$("#dlepopup").dialog("option","position",["0","0"])};if(a){e("subscribe")}else{b(false)}}function whois_view(a){ShowLoading("");$.get(dle_root+"engine/gallery/ajax/file.php",{id:a,skin:dle_skin,act:3},function(e){HideLoading("");$("#dlepopup_galview").remove();if(!e.num||e.num<1){var d=e.title_no;e.title=dle_info}else{var d=[],b;for(var c=0;c<e.num;c++){b=e.alt=="yes"?(dle_root+"user/"+e.data[c][2]+"/"):(dle_root+"index.php?subaction=userinfo&amp;user="+e.data[c][2]);d[c]="<a onclick=\"ShowProfile('"+e.data[c][1]+"', '"+b+"', "+gallery_admin_editusers+'); return false;" href="'+b+'">'+e.data[c][0]+"</a>"}d=d.join(", ");e.title+=" ("+e.num+"):"}$("body").append("<div id='dlepopup_galview' title='"+e.title+"' style='display:none'><br /><div id='dlepopup_galviewcontent' style='overflow:auto;'>"+d+"</div></div>");$("#dlepopup_galview").dialog({autoOpen:true,show:"fade",hide:"fade",width:450,height:150,buttons:{Ok:function(){$(this).dialog("close");$("#dlepopup_galview").remove()}}});if($("#dlepopup_galviewcontent").height()>200){$("#dlepopup_galviewcontent").height(200)}$("#dlepopup_galview").dialog("option","position","center")},"json")}function cat_moderators_show(a){ShowLoading("");$.get(dle_root+"engine/gallery/ajax/category.php",{id:a,skin:dle_skin,act:1},function(e){HideLoading("");$("#dlepopup").remove();if(!e.num||e.num<1){return}else{var d=[],b;for(var c=0;c<e.num;c++){b=e.alt=="yes"?(dle_root+"user/"+e.data[c][2]+"/"):(dle_root+"index.php?subaction=userinfo&amp;user="+e.data[c][2]);d[c]="<a onclick=\"ShowProfile('"+e.data[c][1]+"', '"+b+"', "+gallery_admin_editusers+'); return false;" href="'+b+'">'+e.data[c][0]+"</a>"}d=d.join(", ");e.title+=" ("+e.num+"):"}$("body").append("<div id='dlepopup_galview' title='"+e.title+"' style='display:none'><br /><div id='dlepopup_galviewcontent' style='overflow:auto;'>"+d+"</div></div>");$("#dlepopup_galview").dialog({autoOpen:true,show:"fade",hide:"fade",width:450,height:150,buttons:{Ok:function(){$(this).dialog("close");$("#dlepopup_galview").remove()}}});if($("#dlepopup_galviewcontent").height()>200){$("#dlepopup_galviewcontent").height(200)}$("#dlepopup_galview").dialog("option","position","center")},"json")}function gallery_change_sort(a,c){var b=document.getElementById("gallery_set_sort");b.foto_sort.value=a;b.foto_msort.value=c;b.submit();return false}function GalleryComPage(a,b){ShowLoading("");$.get(dle_root+"engine/gallery/ajax/comments.php",{id:b,action:"list",skin:dle_skin,cstart:a},function(c){HideLoading("");var c=c.split("{comments-delimiter}");$("#ajaxcommslist").html('<div id="blind-animation" style="display:none">'+c[0]+"</div>");$("html"+(!$.browser.opera?",body":"")).animate({scrollTop:$("#ajaxcommslist").position().top-70},700);setTimeout(function(){$("#blind-animation").show("blind",{},1500)},500);if(c[1]){$("#ajaxcommsnav").html(c[1])}})}function ckeck_title(a,e){var d=document.getElementById("entryform");for(var c=0;c<d.elements.length;c++){var b=d.elements[c];if(b.name&&(a=="title"&&b.name.replace(/^(.+?)\[(.+?)$/,"$1")=="title"||a=="cat_title"&&b.name.match(/cat_title/g))&&b.value==""){DLEalert(e,dle_info);return false}}return true}function ckeck_field(b,a){if(a&&a.length>2&&(!fieldcheck[b]||a!=fieldcheck[b])){fieldcheck[b]=a;$.get(dle_root+"engine/gallery/ajax/file.php",{field:b,data:a,skin:dle_skin,act:5},function(c){if(c!="error"){$("#result-"+b).html(c)}})}}function gallery_autocomplete(d,c,a,b){if(!b){var b=3}if(!a){var a=0}d.autocomplete({source:function(g,e){var f=g.term.split(/,\s*/);f=f.pop();$.getJSON(dle_root+c,{term:f,skin:dle_skin},e)},search:function(){var e=this.value.split(/,\s*/);if(a&&a<e.length){return false}e=e.pop();if(b&&e.length<b){return false}},focus:function(){return false},select:function(f,g){var e=this.value.split(/,\s*/);e.pop();e.push(g.item.value);if(!a||a>e.length){e.push("")}this.value=e.join(", ");return false}})}function old_dle_ins(c){if(!document.getElementById("dle-comments-form")){return false}var b=document.getElementById("dle-comments-form").comments;var a="";if(dle_wysiwyg=="0"){if(dle_txt!=""){b.value+=dle_txt;b.focus()}else{b.value+="[b]"+c+"[/b],\n";b.focus()}}else{if(dle_txt!=""){a=dle_txt}else{a="<b>"+c+"</b>,"}if(dle_wysiwyg=="1"){oUtil.obj.focus();oUtil.obj.insertHTML(a+"<br />")}else{tinyMCE.execInstanceCommand("comments","mceInsertContent",false,a,true)}}};